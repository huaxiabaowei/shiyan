# shiyan
摘  要
近几年来，随着城市大建设的迅速发展，各地施工作业不断，外部工程施工对输电线路安全稳定运行带来了极大的隐患，施工作业人员缺乏电力知识，为赶工期逃避审批，擅自施工的现象屡见不鲜。在输电线路的外力破坏等各类故障中，大型车辆违规施工已成为输电线路外力破坏的主要因素，由于大型车辆、机械施工外力破坏事故特有的突发性和分散性,使得电力运行部门防不胜防。所以本文设计了一套基于深度学习的大型违规车辆图像识别系统，来智能检测大型违规车辆对输电线路的破坏。
为了实现对大型违规车辆的实时警报，本文做了如下工作：
（1）本文详细分析了基于深度学习的大型违规车辆图像识别系统的功能性需求，同时也介绍了该系统在实时性、准确性、友好性等方面的非功能性需求。
（2）本文介绍了该系统的架构和设计模式，整个系统分为前端子系统和主站控制子系统两个部分，前端子系统主要负责识别大型车辆、管理前端设备等功能，主站控制子系统主要负责模型训练、远程控制前端设备、拉取信息等功能。
（3）本文对收集到的大型车辆数据集进行了预处理、数据增强，使整个数据集扩增了几十倍，提升了深度学习模型的泛化能力。
（4）本文设计了大型车辆识别算法，通过对多种图像分类神经网络的实验，最终选定MobileNet网络作为基座网络，然后借鉴YOLO算法对图像进行识别。
（5）本文在最后介绍了系统的实现和系统结果展示。
关键词：输电线路，深度学习，前端子系统，主站控制子系统，MobileNet，YOLO



 



输电线路作为电力建设中的重要组成部分，与广大人民群众的生产生活息息相关，是服务民生的重要公共基础设施，对实现全面建成小康社会宏伟目标、促进“新常态”下经济社会发展具有重要的支撑保障作用。
输电是电力系统的重要组成环节，它与发电、变电、配电、用电一起构成电力系统的整体功能。目前远距离电能传输主要采用架空输电线路，其安全运行与电网稳定密切相关，运维工作更是不容忽视。
在我国近140万公里的输电线路中存在很多的潜在问题，例如雷击、覆冰等自然灾害，但最为主要的是外力破坏。外力破坏输电线路日益加重，严重影响电网的安全，同时也对人民生命财产安全构成了极大的威胁。
大型车辆违规施工已成为输电线路外力破坏的主要因素。在线路保护区内盲目施工引起的线路外破主要有以下这些：第一，施工中大型挖掘机挖断地面以上的电缆；第二，吊车与起重机在操作中挂断电线；第三，车辆撞坏电杆；第四，开挖地点距离电杆过近，但未采取保护措施。大型车辆、机械施工外力破坏事故情况复杂、分布面广，同时具有突发性、随机性、分散性的特点，给预控工作带来了很大的挑战。
电力运检部门在输电线路防外破的综合管理工作上， 也在持续推动企业开展输电线路在线监测产品及系统的开发。目前的应对方案中，针对大型车辆违规施工，一般是在高压塔架上安装摄像头或通过无人机拍摄照片、视频，交由给后端中心去人为分析，人工筛选是否存在可能致外破的目标入侵。该方案需要花费众多人力物力，工作量大，实时性差，效率低下。
当前，部分企业可以使用模式识别技术自动识别部分大型施工车辆，该技术一定程度上降低了企业成本，提高了工作效率。但是，模式识别受限于本身技术瓶颈，误报率较高，而且当训练数据达到一定量后，识别效果无法进一步提升。
因此，建设一套高效、实用的实时在线监测系统，防止输电线路遭到破坏，为线路安全运行提供有效的保障手段，是非常有必要的。



1.2 系统开发的目的及意义
城市建设的快速发展，对输电线路进行电力供应的安全性提出了更高的要求。建立完整的输电线路智能防外破系统，有助于提高输电线路安全的保障率。以此为基础确立在保障输电线安全方面的关键技术与方法，并且实现软硬结合的异物识别智能系统。
防外力破坏工作是一项长期的、艰苦的、复杂的工作，只有充分利用科技的力量，才能最大限度地消除和限制可能损害输电设施的不安全因素，确保电力设施安全、可靠供电，同时尽量节省人力，无需长途跋涉即可获取精准的实时监测结果。 
将人工智能应用到输电线路防外破，能够及时制止威胁线路安全的行为，实现快速、有效地线路外破预控工作，提升防护手段多样化、智能化，进一步提高电网自动化程度，推动实现电网人工智能布局，为电网系统提供有效、高效的线路安全保障方案。
实行科学的智能防外破的方案，能够确保输电线路运行的安全稳定，促进电力行业的蓬勃发展；运用科学的输电线路管理思维，综合人防、物防、技防等科学手段，能够确保电力系统稳定安全地工作，促进建立有效、高效、卓有成效的防护体系。

1.3 国内外研究现状
输电线路的外力破坏现象近年来逐步引起了人们的重视，目前国内外已经研发出了各种不同类型的防外破装置。早期设计的防外破装置有红外探测装置和声控探测装置。近年来，开发了诸多新型的防外力破坏装置，主要有基于微波感应的探测系统、基于加速度传感器的监测系统、基于雷达的探测器系统、基于激光的探测器系统。此外还有视频监测系统，它是现阶段应用范围最广、应用最多的监测系统。但目前利用深度学习技术开发的防外破系统还很少见。
近年来由于深度学习的逐步兴起以及大数据时代的到来，我们完全有能力取得足够多的数据，突破深度学习的数据量瓶颈并开发电网的防外破系统，其在识别准确率及误报率上相对以前的技术都能有明显的提高。
图像分类技术只需要解决判断图像中有哪些物体的问题就可以了。在神经网络中，图像分类技术是图像识别技术的基础。目前主流的图像识别神经网络模型主要分为两个部分，一个部分是基座网络，用来提取图像的高维特征。另一个部分是识别系统，利用提取的图像特征得到物体的位置、类别以及置信度。而第一部分的基座网络就是通过用于图像分类的神经网络得到，所以训练出一个精度较高的图像分类网络对于图像识别至关重要。
Yann LeCun等人提出了著名的图像分类网络lenet-5，将其应用在手写并数字分类中。顾名思义，该网络的卷积层和全连接层一共有5层。LeNet-5网络成功运用了反向传播算法，构建了多层神经网络，为后来卷积神经网络的发展奠定了基础。但是，因为卷积神经网络（CNN）对数据和计算能力要求较高，所以神经网络发展一直非常缓慢。
然而，随着互联网的发展，人们获取数据的方式越来越方便，机器的计算能力有了很大的发展。神经网络在计算机视觉中的地位也变得越来越重要。2012年，在ImageNet竞赛中，AlexNet网络成功扩展了Lenet5网络，并在ImageNet数据集中取得了top-5错误率仅16.4%的错误率，比传统的图像处理算法提升了将近10%的精度。在AlexNet网络中，使用了非常多的新技巧，对以后神经网络的发展产生了很大的影响。首先，AlexNet网络放弃了sigmoid激活函数，改用ReLU激活函数，保证了函数值不会大部分分布在0或1的附近，避免了深层神经网络	梯度消失的问题。然后AlexNet网络使用dropout（失活），在训练时以一定的概率随机将一些神经元失活，避免神经网络出现过拟合的情况。AlexNet还使用最大池化层，有利于保留图像的细节信息，同时使用LRN网络进行局部抑制，使模型的泛化能力得到了很大的提高。在困扰神经网络的计算能力和数据两个难题方面，AlexNet使用CUDA对神经网络进行训练，利用gpu对数据的并行处理能力，加速迭代，为了能够存储AlexNet网络的大量参数，训练时使用两块GPU，使用模型并行的方式进行训练，每一个GPU负责一半的参数。最后，AlexNet网络对数据进行了增强，截取图像的固定大小的部分，同时对图像进行水平翻转，极大地扩充了数据的数量。
2014年，VGGNet网络在ImageNet 大规模视觉识别挑战赛上获得了非常好的成绩，VGGNet使用的卷积核全部是3*3的卷积核，参数数量大幅减少，降低了模型的过拟合，可以加深VGGNet网络，最深的VGGNet网络一共达到了19层，以提取更高维度的特征。训练模型时，对图片进行缩放，并随机裁剪图片扩充数据集。同年，GoogleInceptionNet在本次大赛上取得了第一名，被称为Inception v1网络。以往的神经网络只是增加深度，而Inception v1网络不仅仅增加了网络的深度，还增加了神经网络的宽度。Inception v1的基本结构是Inception module,一共由4个分支组成，使用了多个1*1的卷积核，可以有效地减少模型的参数，4个分支的输出在最后一维（输出维度）上合并，扩展了网络的宽度，并提高了模型在不同尺度上的敏感性。与此同时，神经网络的参数主要集中在全连接层，Inception v1网络使用avg pooling代替最后的全连接层，大幅减少了参数的数量，这使得网络可以增加到20多层，降低了过拟合。Inception v1减少参数数量，一方面可以使用较少的图像数据就可以使模型收敛，另一方面可以节约珍贵的计算资源。Inception V2的使用了两个3*3卷积核带起Inception V1中的5*5卷积核。同时，为了加强Inception网络的泛化能力，Inception V2使用了Batch Nomalization(BN)方法来正则化神经网络，所以神经网络可以去掉LRN之类的正则化trick,大大加快了模型的收敛速度。BN方法的基本思想是在神经网络的输出进行处理，使输出数据服从高斯分布N(0,1)。为了进一步减少参数数量，可以将一个二维卷积转为两个一维卷积，并在分支中使用了分支，增强了神经网络的表达能力。Inception-resnet结合了Inception和resnet网络的思想，并加深了网络。
ResNet网络在2015年ImageNet视觉挑战赛上将top-5的错误率降低到了3.57%，并可以减少模型训练的时间。以往传统的卷积神经网络下一层的输入是上一层的输出，而ResNet神经网络可以将输出直接输入到后面两层或三层的神经网络。通常，神经网络越深，其精度也越高，但是训练难度越大。而ResNet网络可以有效地保留图像的有关信息，减轻梯度消失和梯度爆炸的问题。基于这一性质，神经网络的深度可以达到100多层。
为了在手机和嵌入式设备上使用视觉应用，Google提出了MobileNets网络，利用深度可分离卷积和点卷积建立轻量化神经网络。与以往的图像分类网络相比，MobileNets网络的参数可以减少到原来的接近十分之一，在保证精度的同时，前向传播的速度大大加快。由于网络得到了极大的压缩，所以训练时的收敛速度也非常快。
2.2 基于深度学习的图像识别技术研究现状
（1）RCNN系列算法
随着神经网络在图像分类任务上的成功，如何利用神经网络提取的特征进行目标检测，解决经典算法提取图像特征较难的问题，成为了一个非常热门的话题。首先在这一领域做出突破性进展的是RCNN算法，在VOC数据集上目标检测的精度达到了50%以上，比以往经典的图像检测算法高了10%以上。
RCNN的基本流程如下：
使用ss算法根据图像的纹理、颜色等特征提取图像的候选框，文章中提取出的候选框的数量是2000个。
因为候选框的尺寸不同，所以需要将候选框缩放到固定的大小，然后再经过卷积神经网络提取图像的特征。卷积神经网络可以是经典的卷积神经网络，比如AlexNet、VGG16、GoogleInceptionNet网络，然后利用已经训练好的预训练网络进行微调，可以极大地加快神经网络的训练速度。最后使用全连接层将cnn提取的图像特征映射成4096维向量。
最后使用SVM算法对所有候选框提取出的特征向量进行分类，判断每个候选框是否包含物体以及包含哪个物体。
RCNN算法对每个候选框提取特征，使用SVM分类，训练时间复杂度和空间复杂度太高，测试时间较长。为了加快RCNN运行速度，Fast RCNN算法直接提取整个图像的特征图，根据ss算法生成的候选框提取相应位置的特征，然后将提取出的特征送入两个全连接网络，其中一个输出候选框的bbox回归，另一个输出该候选框每个类别的得分。
但是Fast RCNN算法在生成候选框时使用selective search算法，仍然会耗费非常多的时间。Faster RCNN则解决了这个问题，使用RPN（候选区域网络）来生成proposal，从而使整个模型是端到端的。Faster RCNN网络在经过一个基础网络（比如VGG16网络）提取出特征图，然后将特征图送入RPN网络。Faster RCNN中的RPN网络会在每一个特征点上产生9个矩形anchor，这9个anchor中大小比例是8:16:32，矩形anchor的长宽比例分别是1:2,1:1,2:1。RPN网络分为两个分支，其中一个分支判断每一个anchor是否有物体，另一个分支调整每一个anchor的位置，最后生成候选框。然后将每一个候选框经过roi pooling层，送入两个全连接层，进行位置回归和分类。
（2）YOLO算法
RCNN系列算法的一个问题是检测速度无法到达实时性的要求，最主要的原因是在生成proposal所用的时间太长。而YOLO算法直接将图像分成7*7的网格，每个网格预测B个bounding box（论文中B=2）。YOLO算法对bounding box进行位置回归和类别置信度回归，最后使用nms算法删除重叠较高的bounding box。YOLO算法的速度非常快，在GPU上能够达到每秒45帧。与RCNN系列算法相比，YOLO误检测率很低，而且泛化能力较强。但是，YOLO算法在识别小目标时检测精度较低。
（3）SSD算法
以往的目标识别算法都是在最后一层特征图识别目标，而SSD算法利用了多个尺度和层次的
特征图进行预测。以VGG16为基础网络的SSD神经网络为例，将VGG16网络中最后的全连接层替换成CNN网络，最后再连接4个CNN网络。在这5个特征图之后分别连接两个卷积网络，分别预测每个default box每一个类别的置信度和位置。



2 需求分析
需求分析是软件系统开发过程中最重要的环节，需求分析是否准确直接关系到整个开发工作的成败，如果开发工作建立在一个错误的需求分析基础上，无论之后的系统架构设计和程序代码质量多么完美，系统的开发工作最终也必然会失败。本章从系统综合描述、外部接口需求、系统功能性需求及非功能性需求四个方面来对该系统进行需求分析。
2.1 综合描述
2.1.1 系统的功能
本系统的最主要目的是为了实现电网防外破的自动化识别，因此一切功能需围绕此展开。防外破系统需要两部分，一是运行在电网的若干识别系统，另一个是接收警报信息的主站系统，两者通过网络互联，随时通信。
因此可将本系统分为前端设备子系统和主站子系统，前端设备子系统为运行在电网中，搭载摄像头的设备，主站子系统为接收前端设备发来的信息、控制并维护前端设备的系统，用户通过主站子系统的网页进行操作，因此系统应包含如下功能，
前端设备子系统：
·从摄像头获取图像并识别，若发现目标则将警报信息实时传回主站
·接收主站发来的信息并执行
主站子系统：
·接收前端设备传回的信息
·设置前端设备的ID及地址等信息
·远程控制前端设备
·动态模型训练
两个子系统在网络互连下相互配合，以满足低成本、高效率的电网防外破自动化识别需求。
2.1.2 用户类和特性
本系统的主要用户为电网工作人员，用户不一定有专业的计算机知识，因此需要一个友好简单的操作界面。用户通过该操作界面可以简单地获取电网中有外破危险的警报并作出相应反应，以及对前端设备进行控制和维护等。
预期用户可以不经过任何培训就能熟练使用此系统。
2.1.3 系统运行环境
由于前端设备子系统需要对图像进行识别，为了满足实时性需求和存储需求，需要较高配置的硬件环境：
·ARM处理器
·嵌入式GPU
·内存至少8GB
·SSD硬盘至少120GB
为了支持深度学习、信息处理存储以及网络通信等需求，软件环境应包含：
·Linux操作系统
·SQLite数据库
·MQTT消息推送协议
主站用于接收并存储前端设备发来的消息、控制和维护前端设备，因此需要具备数据可靠性和日常计算能力，其硬件环境：
·Intel至强四核处理器
·50TB硬盘
软件环境应支持信息处理存储及网络通信等需求：
·Linux操作系统
·MySQL数据库
·MQTT消息推送协议
2.1.4 设计和实现上的限制
本系统的深度学习目标检测部分拟采用YOLOv2算法，在实现时需要经历若干次数据准备、参数调整、训练及测试的过程，尤其在数据准备期间需花费大量的时间和精力，得到好的检测效果可能需要很长时间。
系统功能设计中需要从主站控制前端设备摄像头的焦距和方位等，这依赖于摄像头提供的开发库。该项目前端硬件系统较复杂，需要考虑很多兼容性问题。
之前没有开发类似项目的经验，需要不断学习，解决开发过程中出现的问题。
2.1.5 假设和约束
系统分为前端设备子系统和主站子系统，每个子系统又由若干功能模块组成，系统之间又需要通信模块的支持，因此各个模块之间的稳定协作需要得到保证，以保证系统的稳定运行，尽量能保证周期性的维护。
2.2 外部接口需求
2.2.1 用户界面
本系统的用户为电网工作人员，并不一定具有专业的计算机知识，因此需要提供尽可能简洁的网页界面，争取直观地传递给用户尽量多的信息。
2.2.2 通信接口
主站子系统在用户访问时也作为服务器，因此需要遵循各种网络协议，满足各种浏览器的需求，包括移动设备。
2.3 系统功能性需求
2.3.1 数据要求
本系统需要在电网智能识别出外破危险，而近年来的外力破坏主要是由违规施工的大型车辆造成的，因此系统目的就是识别这些大型施工车辆，所以需要通过各方渠道准备大量的包含大型施工车辆的工地照片作为训练和测试数据。
深度学习是非常依赖于数据量的，可以说数据的好坏及数据量的多少直接决定了最终的识别效果，因此本系统对数据的要求非常高。
除此之外，在系统运行过程中，前端设备会向主站传送状态信息、状态警报或危险入侵警报。
状态信息需要包含如下数据：
·前端设备位置
·时间
·前端设备电量
·太阳能板信息
状态警报需要包含如下数据：
·警报类型
·前端设备位置
·警报时间
·前端设备状态信息（电量、太阳能板信息）
危险入侵警报需要包含如下数据：
·警报类型
·前端设备位置
·警报时间
·识别到大型施工车辆并经过加工的视频或图像
2.3.2 系统功能总体需求
前端设备子系统会自动进行识别和消息推送，主站可以远程控制每个前端设备，因此前端设备子系统需要实现的功能包含如下几部分：
·深度学习智能识别
·图片与视频处理
·接收和推送信息
主站子系统是用户直接访问的系统，需要如下功能：
·设置前端设备ID及地址
·接收警报信息或状态信息
·远程控制前端设备
2.4 系统非功能性需求
2.4.1 易用性要求
首先需要保证该系统易于安装调试，还需要保证没有专业计算机知识的电网工作人员可以在短时间培训后熟练运用本系统，本系统对易用性的要求是用户能在1小时之内掌握全部功能的操作。

2.4.2 可靠性要求
本系统应能保证一周7天，一天24小时不间断运行，夜间可以关机，关机时间不超过20%。
系统的平均无故障时间MTBF不小于1000小时。
2.4.3 性能要求
前端设备子系统中的智能识别模块应保证至少5秒识别一张图像。
主站系统的数据库应保证同时支持100个前端设备的并发信息传送。
对前端设备的控制保证在10秒内完成。
2.4.4 安全性要求
本系统面向电网工作人员，无一般用户和管理员的权限区分，用户即有全部权限，但应保证只有电网用户才可以修改主站及前端设备的数据库，避免系统被外网非用户操作。
数据在前端设备存储和传输过程中应加密，以保证数据安全。
2.4.5 可支持性要求
本系统主站子系统的更新由开发人员完成。
前端设备子系统的更新以及识别模型的更新可在主站远程完成，可由用户通过用户界面的简单操作完成。
图1 智能防外破系统的软件架构

本系统分为前端设备子系统和主站子系统两部分。

一、前端设备子系统
前端设备子系统在功能上可分为总控模块、图像识别模块、视频处理模块、文件修改模块、状态采集模块、加密模块、设备遥控模块及数据库模块。
前端系统采用Linux，在Python编程语言下实现
1、总控模块
总控模块为始终不断运行在前端设备的模块，它协调调用系统的各个模块以完成系统智能识别外破危险并推送消息的功能。
2、 图像识别模块
图像识别模块为搭载了深度学习算法、接受总控模块的命令不断识别图像中有无大型施工车辆的模块。由于电网中摄像头的试场较大，识别目标可能较小，因此采用深度学习目标检测算法。
深度学习目标检测算法主要有RCNN[5]，Fast-RCNN[6]，Faster-RCNN[7]，YOLO[8]，SSD[9]，Mask-RCNN[10]等，RCNN和Fast-RCNN算法识别效率低，精确度低，已经很少有人使用，Faster-RCNN虽然可以满足实时性要求，但是准确率仍然难以满足系统需求，而Mask-RCNN计算量又略大，本系统采用YOLOv2算法，在不失效率和准确率的同时，资源占用不至于太大，更加适合嵌入式环境。而且YOLOv2在原版本基础上进行了改进，使用了一些方法和技巧，在精度上有了一些提升，在VOC2007数据集上的mAP达到了78.6%，并且识别可以满足实时性需求。
本项目采用YOLOv2算法并不断针对该项目的特殊性对算法进行改进，利用大量从各方途径收集到的包含大型施工车辆的图像进行训练。建立一个完整的、与训练图像无任何交集的测试集，包含正样本测试集（包含大型施工车辆）和负样本测试集（不包含大型施工车辆）。训练以一月为周期，包含处理数据、设计算法、训练和测试，每月在测试集上得到一次测试结果，进行科学严谨的误差分析，为之后算法及数据集的改进提供大致方向。
该模块应对总控模块提供接口，使总控模块可以方便的调用识别模块，对图像进行识别并获取识别结果。
3、视频处理模块
该项目视频处理模块分为两部分
（1）从视频流中提取关键帧
YOLOv2算法输入的是图片而不是视频，而识别模块实时性满足不了逐帧识别，因此如何从视频流中抽取图像比较关键。
前端设备组工作时，摄像头拍摄的视频通过RSTP协议直接发送到主板，主板提取关键帧并进行后续分析。
由于视频序列中相邻帧一般具有相似性和连续性，如果在图像坐标系下将所有的视频帧重叠起来，那么一个镜头中所有视频帧的特征矢量在其特征空间中会形成一个轨迹，轨迹上的关键特征值对应的帧即为关键帧。关键帧抽取的过程分为两个步骤：寻找图像中某特种的量化参数；判断当前帧特征量化的参数是否为关键的特征值。
输电线路防外破智能监测主要查看当前区域是否出现入侵目标，于是选择使用基于内容分析的方法提取关键帧[11]，使用特征信息之间的距离度量，计算前一帧与剩余帧之差，如果差值过大，则说明内容差别较大，会选择内容上比较有代表性的帧作为关键帧。
（2）将识别结果处理到视频中
总控模块调用识别模块对提取的关键帧进行识别之后，若识别出有大型施工车辆，则需要对视频进行处理，将报警信息打印到视频中。
4、文件修改模块
该系统处理文件可分为两部分
（1）处理设备信息
设备基本信息保存在前端设备的一个配置文件中，因此如果需要修改设备信息，就需要文件修改模块对其进行操作。
（2）处理图像、视频
报警信息生成后，图像和视频需要保存在磁盘中，数据库中存储图像和视频的目录，当报警信息超过设置的最大保存时间后，文件修改模块要配合总控对数据库的修改，清理磁盘中的图像和视频，保证系统持续稳定运行。
5、状态采集模块
该系统会定时采集设备的状态，如电池组的电量、温度、状态等，也会受到主站发来的获取设备状态请求。
6、加密模块
图像、视频以及各种信息存储在该系统中，前端设备和主站之间通过网络传递信息，需要对数据进行加密保护，防止数据遭到破坏和盗取。
7、设备遥控模块
用户通过主站可以控制前端设备，如控制摄像头的焦距、方向，控制设备的启停等，设备遥控模块处理主站发来的消息，并执行在摄像头或设备上。这依赖于硬件设备之间的相互兼容，摄像头的开发库应兼容我们的主板设备。
8、数据库模块
前端设备子系统的数据库中应保存设备状态信息及报警信息，该模块可以对数据库的这些信息进行增、删、改、查。

二、主站子系统
主站子系统在功能上可分为文件修改模块、数据库模块及用户界面。
1、文件修改模块
主站子系统接收到前端设备子系统发来的报警信息中，包含了发生报警的图像和视频，图像和视频保存在主站的磁盘中，主站数据库中存储图像和视频的目录，当报警信息超过设置的的最大保存时间后，文件修改模块要配合对数据库的修改，清理磁盘中的图像和视频，保证系统持续稳定运行。
2、数据库模块
主站子系统的数据库中应保存用户信息、前端设备信息、历史状态信息和历史报警信息，该模块可以对数据库这些信息进行增、删、改、查。
3、用户界面
主站子系统对用户开启http服务，以网页的形式对用户提供智能防外破系统的功能。
该系统的用户为电网工作人员，不一定具备专业的计算机知识，因此需要提供尽可能简洁的网页界面，争取直观地传递给用户尽量多的信息。

三、子系统间通信
前端设备子系统和主站子系统之间的通信采用MQTT消息推送协议，MQTT是一个基于客户端-服务器的消息发布/订阅传输协议，它是一个轻量、简单、开放和易于实现的通信协议，目前在很多情况下，包括受限的环境中，如机器与机器通信和物联网中已广泛使用。该通信协议非常适合前端设备和主站之间的通信。








3 系统架构设计
系统的架构必须从各个方面满足实际的需求，同时在设计与开发的过程中严格遵守架构的约束，从而保证实现架构设计的最终目标。
3.1 架构的目标及约束
系统架构设计的目标包括安全目标、保密目标、简洁、灵活等方面的规定。
1、安全目标：架构从管理安全、系统安全、数据安全三个方面来具体考虑和保障系统安全。系统安全从网络、硬件、系统软件、应用软件等方面考虑。数据安全是指不丢失、不泄露等。
2、保密目标：严格按照管理权限管理数据，不允许越权使用，不允许外部应用系统访问。
3、最大化的重用：重用是减少冗余的一个有效的途径，包括组件级别的重用。
4、简洁：把复杂问题简单化是架构设计的一个重要目标，明确类以及类之间的职责关系。
5、可靠性：是指系统可以提供高可靠性、高可用性的系统，增强容错处理能力。
6、可扩展性：系统在设计时，充分考虑未来组织结构等情况的变化，将因业务或者需求的变更带来的系统升级和改造工作将至最低。
本系统为了实现架构的目标，遵循RUP软件开发过程，在设计策略、开发策略、技术规范、平台规范方面进行约束。
1、分析、设计策略：采用面向对象的分析和设计方法，RUP作为软件开发过程，UML作为建模语言。
2、开发策略：必须采用相应的开发工具，由测试驱动开发。
3、技术规范：要建立必要的设计和开发规范。
4、平台规范：采用Python编程语言，操作系统采用Linux，主站web服务应支持用户浏览器IE8以上。



3.2 系统总体架构
本系统由前端设备子系统和主站子系统组成，前端设备子系统为运行在电网中、搭载摄像头的识别设备，主站子系统为接收前端设备的信息、控制及维护前端设备的系统，两个子系统通过网络互连。主站子系统同时开启web服务器，使用户可以通过网页界面完成系统的全部功能。
3.3 系统功能架构
前端设备为运行在电网中，搭载摄像头的装置。其系统应包含深度学习平台部署、图片与视频处理、远程控制、信息推送、数据存储等，其功能结构如下图所示。
前端装置中首先应包含深度学习平台的部署，它是防外破系统的算法核心，应搭载训练好的识别系统，可以识别塔吊、吊车、水泥泵车、大型挖土机、推土机等违规施工的大型车辆，并可以支持模型的动态更新，以便在投入应用以后也可以上传新模型到各个前端装置中。还应包含图片与视频的处理功能，当设备识别出违规施工的大型车辆后，应实时获取图像及截取视频，并标出时间戳、监控区域、检测目标等。推送信息的功能是为了将设备信息及报警信息推送到主站子系统中，以便工作人员及时掌握设备的情况以及该场景电网有无外破危险。前端装置中必须要有存储数据的功能，以便保存至少10天的报警信息，应支持存储卡的容量扩展。此外还有一些其他控制功能，如通讯、摄像头数据及获取辅助设备状态。
主站子系统为若干前端设备的服务器，用于接收及存储前端设备发来的信息，控制及维护前端设备的主站。其功能应包含接受信息、设置设备信息、远程控制及动态模型训练等，功能结构如下图所示。
主站子系统用于接收信息和控制前端设备，因此需要有接收信息功能，用来接收并保存前端设备发来的设备信息及报警信息。由于主站子系统及前端设备子系统有若干，需要设置每台设备的ID及地址等信息，因此该功能也是必要的。远程控制功能可以远程获取前端设备的报警信息和状态信息，并且可以控制前端设备的摄像头以及启停前端设备。我们还需要动态模型训练的功能，由于深度学习所需要的数据量很大，随着数据量的增大，模型也应该是在逐步提高的，前端设备不断检测到违规施工的大型车量并传回信息，主站可以不断地获得新数据，并动态训练模型，上传模型。

3.4 系统部署架构
本部分从硬件及软件部署说明系统的部署架构。
系统的硬件部署为将若干前端设备安装在电网线路区域，将主站服务器置于电网机房中，主站和前端设备互为服务与客户端，可以相互发送信息。
系统的软件部署分为前端设备子系统软件部署及主站子系统软件部署。
前端设备子系统的总控为主进程，在总控运行中不断配合调用图像识别、视频处理、数据库、文件修改、状态采集、加密、设备遥控等软件模块以完成上述功能架构。
主站子系统包含数据库及文件修改模块，用户通过网页界面进行操作，调用这些模块完成控制和维护的功能。
前端设备及主站之间的通信使用MQTT协议，这两个系统都是服务器，也都是客户端，用来进行数据的相互传输。用户查询网站采用的是B/S架构。

3.5 系统安全架构
信息系统的安全包括多个方面，例如信息的存储、传输、访问等都属于信息系统安全的范畴。由于信息系统是分层次的，因此系统的安全也是要分层设计。
系统层次	涉及内容	安全手段
物理层	硬件、网络拓扑、传输介质、环境	防硬件损坏、尘、雷、火、盗、抗干扰等
系统层	操作系统	补丁、安全加固、访问控制、信息加密等
网络层	逻辑拓扑、通信协议	防火墙、IDS、VLAN、VPN等
应用层	通用应用层	用户开发的应用程序、CGI等	数据加密、Web应用安全产品
	用户自定义层		
管理层	管理制度、人员技术、素质	网络设施管理、培训、制度、责任、考核
表3-1 系统安全层次及着重点划分
该系统必须要每一层都达到一定标准，才能建立可信的安全环境。
首先该系统的前端设备子系统运行在户外电网中，环境多变且复杂，如尘、雷、雨、火、盗等安全隐患随时存在，因此该系统的物理层安全至关重要。需要采取物理防护措施，将设备安装在安全可靠的防护外壳中。
在系统层中，不论前端设备或主站均采用Linux操作系统，为保证上层的网络层或应用层稳定，系统的安全防护非常重要。需对系统安装安全补丁，进行访问控制及信息加密。
在网络层中，前端设备和主站之间采用MQTT消息推送协议，主站采用http通信协议作为用户的服务器，只有网络通信不受干扰，才能保证系统的一切环节协调稳定运行。因此一切流入或流出系统的数据都应经过防火墙，接受防火墙的检查。
该系统的主要开发工作就是架设在应用层中的，因此应用层安全一定要得到保证，如存储和传输数据的加密，服务器不被入侵等，防止人为、有意或无意对应用层系统进行的破坏。
该系统用户不分权限等级，具有操作系统全部功能的权限，因此用户的技术水平、素质等也需要得到保障，防止系统被破坏。可以建立培训、考核等人员管理机制。

3.6 系统存储架构
数据可以说是系统最核心的部分，有关数据的存储方案是系统架构设计中的核心部分。存储设计需要同时关注数据安全和存取性能两个方面的问题。
由于该项目的数据包含图像、视频这类非结构化数据，很难直接存储到数据库中，因此采取将图像或视频存储在磁盘中，而在数据库中存储图像或视频的文件目录。
前端设备子系统采用SSD固态硬盘存储数据，适合嵌入式设备，读写速度快，存储容量足够，同时可以保证数据的安全性。
主站子系统存储介质采用高性能的磁盘阵列，因为需要不断存储前端设备发回的数据，需要至少50TB容量，也能保证数据的安全性。
不同前端设备发回的数据存储在主站的同一个数据库中，采用相同的结构，但逻辑上可以划分为不同的分区，彼此之间保持一定的独立性，这样可以大大提高数据存取的效率。
3.7 系统硬件架构
输电线路塔架数量多，分布面广，自然环境及地理条件复杂多变，考虑到使用环境的多样性、设备的稳定性与实用性、数据传输的准确性与及时性，输电线路智能防外破监测的硬件系统主要由独立的前端设备硬件组、主站服务器两部分组成。
前端设备组由摄像头、主板、固态硬盘、4G模块、太阳能电池板、蓄电池、电源信息采集器及电源转换器组成。其中摄像头和主板通过有线连接，主板和主站服务器之间的通信采用4G网络。主板包含ARM处理器、嵌入式GPU及SD卡，提供强大的图像计算能力，兼具低功耗的特点。
主站服务器包含50TB的硬盘和Intel至强四核处理器，保证数据可靠性和日常计算力。










4 系统详细设计
系统详细设计是对系统架构设计的精化，主要是在系统需求规格和架构设计的基础上，对系统用例中使用的类和对象进行进一步的精化，确定每一个类的属性和方法。本章主要描述了系统详细设计所采用的的过程和方法。按照统一软件过程和统一建模语言的要求，系统功能的详细设计包括系统在静态属性方面的设计和动态功能方面的设计。系统的静态属性设计主要是用类图来描述，动态功能主要是用时序图来描述。类图主要描述了系统实体之间的静态关系，时序图则描述了各对象之间的动态交互关系。本系统重点放在数据库设计、用例设计、时序图方面。
4.1 前端设备子系统详细设计
前端设备子系统详细设计包含数据库详细设计和操作时序图详细设计，由于前端设备子系统是自动不间断执行并且由主站子系统控制的，因此不包含用例详细设计。
4.1.1 数据库详细设计
该系统前端设备子系统的数据库中只需要存储状态信息及报警信息，状态信息存储了前端设备的相关硬件状态，报警信息存储了设备状态报警或危险入侵报警的记录。前端设备子系统采用SQLite数据库。
对于某个前端设备，它自己的基本信息是不变的，所以设备数据库中不需要存储基本信息。每个设备有一个配置文件，用来保存自己的基本信息，存在固定的路径上。
前端设备子系统的数据库逻辑设计如下表所示。
字段	数据类型	限定	格式	说明
StatusID	INT	PRIMARY KEY
AUTO_INCREMENT		状态编号
StatusUpdateTime	DATETIME	NOT NULL	YYYY-MM-DD HH:MM:SS	状态更新时间
DeviceID	INT	FOREIGN KEY
NOT NULL		设备编号
SolarPanelVoltage	INT		[0,100]	太阳能板电压
SolarPanelCurrent	INT		[0,100]	太阳能板电流
BatteryLife	INT		[0,100]	蓄电池电量
BatteryTemperature	FLOAT		[-30,70]	蓄电池温度
Charge-DischargeStatus	INT		{0,1}	充放电状态
ChargePower	INT		[0,100]	充电功率
DischargePower	INT		[0,200]	放电功率
ChargeCurrent	INT		[0,10]	充电电流
DischargeCurrent	INT		[0,20]	放电电流
表4-1 前端设备数据库状态信息表设计
注：蓄电池电量（BatteryLife）为百分比数值。蓄电池充放电状态（Charge-DischargeStatus）为0或1，0表示没有在充电，1表示正在充电。
字段	数据类型	限定	格式	说明
AlarmID	INT	PRIMARY KEY
AUTO_INCREMENT		报警编号
AlarmType	varchar	NOT NULL	Low Battery
Foreign Invasion	报警类型
DeviceID	INT	FOREIGN KEY
NOT NULL		设备编号
AlarmTime	DATETIME	NOT NULL	YYYY-MM-DD HH:MM:SS	报警时间
AlarmMessages	VARCHAR	NOT NULL		报警内容
AlarmImage	VARCHAR			报警图片
AlarmVideo	VARCHAR			报警视频
表4-2 前端设备数据库报警信息表设计
注：报警类型（AlarmType）有两种，低电量警报及异物入侵警报。设备编号（DeciveID）是为了在主站读取警报的位置，即设备所在的位置。报警内容（AlarmMessage），若为低电量警报，则其值为30%、20%或10，若为异物入侵警报，则其值为入侵的施工车辆类型。报警图片（AlarmImage）及报警视频（AlarmVideo）存储经过处理后的报警图片、视频的路径，若报警类型为低电量报警，则其值为空。


4.1.2 操作时序图
前端设备子系统的主要工作是不间断的识别有无大型施工车辆、定期检查设备状态并发送给主站，因此操作时序图分为状态自检与目标检测两部分。
状态自检操作是设备定期自动执行的操作，首先向电池组发送请求，获取到电池组的相关状态信息，再将信息存储到数据库中的状态信息表中，最后将信息通过网络发送到主站子系统中，以保证主站子系统能掌握设备的最新状态信息。如果获取到的电池组信息中显示蓄电池电量低下（低于30%），则生成报警信息，保存在数据库报警信息表中，然后将报警信息发送到主站子系统中。
目标检测操作是设备始终在执行的操作，首先系统向目标检测模块发送运行指令，系统此时执行一次目标检测操作，如果检测到异物入侵，则生成报警信息，并保存到数据库报警信息表中，然后将报警信息发送到主站子系统中，如果没有检测到异物入侵，则之后不执行操作。

4.2 主站子系统详细设计
主站子系统详细设计包含数据库详细设计、用例详细设计、操作时序图详细设计以及界面详细设计。
4.2.1 数据库详细设计
主站子系统中包含的实体有用户、主站、前端设备、状态信息及警报信息。一个用户可以管理多个主站，每个主站也可以由多个用户来管理。一个主站可以有多个前端设备，但每个前端设备只能属于一个主站。状态信息和报警信息由前端设备产生，每个前端设备可以产生多个状态信息和报警信息，因此数据库E-R图设计如下。

由E-R图进行逻辑设计，数据库中有用户信息、前端设备信息、历史状态和历史报警4个表。
字段	数据类型	限定	说明
UserID	INT	PRIMARY KEY
NOT NULL	用户编号
UserName	VARCHAR	NOT NULL	用户名
Password	VARCHAR	NOT NULL	登录密码
表4-3 主站数据库用户信息表设计
字段	数据类型	限定	说明
DeviceID	INT	PRIMARY KEY
NOT NULL	设备编号
MacAddress	CHAR	NOT NULL	mac地址
Location	VARCHAR	NOT NULL	设备的位置
PolesID	INT	NOT NULL	设备所在杆塔的编号
CameraSerial	VARCHAR	NOT NULL	设备控制的摄像头序列号
CameraIP	VARCHAR	NOT NULL	设备控制的摄像头IP地址
BatteryVoltage	INT		蓄电池电压
表4-4 主站数据库前端设备信息表设计

字段	数据类型	限定	格式	说明
StatusID	INT	PRIMARY KEY
AUTO_INCREMENT		状态编号
StatusUpdateTime	DATETIME	NOT NULL	YYYY-MM-DD HH:MM:SS	状态更新时间
DeviceID	INT	FOREIGN KEY
NOT NULL		设备编号
SelfCheck	INT		{0,1}	好或者不好
SolarPanelVoltage	INT			太阳能板电压
SolarPanelCurrent	INT			太阳能板电流
BatteryLife	INT		[0,100]	蓄电池电量
BatteryTemperature	FLOAT			蓄电池温度
Charge-DischargeStatus	INT		{0,1}	充放电状态
ChargePower	INT			充电功率
DischargePower	INT			放电功率
ChargeCurrent	INT			充电电流
DischargeCurrent	INT			放电电流
表4-5 主站数据库历史状态表设计
注：蓄电池电量（BatteryLife）为百分比数值。蓄电池充放电状态（Charge-DischargeStatus）为0或1，0表示没有在充电，1表示正在充电。
字段	数据类型	限定	格式	说明
AlarmID	INT	PRIMARY KEY
AUTO_INCREMENT		报警编号
AlarmType	VARCHAR	NOT NULL	Low Battery
Foreign Invasion
Communication Failure 	报警类型
DeviceID	INT	FOREIGN KEY
NOT NULL		设备编号
AlarmTime	DATETIME	NOT NULL	YYYY-MM-DD HH:MM:SS	报警时间
AlarmMessages	VARCHAR	NOT NULL		报警内容
AlarmImage	VARCHAR			报警图片
AlarmVideo	VARCHAR			报警视频
表4-6 主站数据库历史报警表设计
注：报警类型（AlarmType）有三种，低电量警报、异物入侵警报及连接失败警报。设备编号（DeciveID）是为了读取警报的位置，即设备所在的位置。报警内容（AlarmMessage），若为低电量警报，则其值为30%、20%或10，若为异物入侵警报，则其值为入侵的施工车辆类型。报警图片（AlarmImage）及报警视频（AlarmVideo）存储经过处理后的报警图片、视频的路径，若报警类型为低电量报警，则其值为空。

4.2.2 用例详细设计
用户通过网页界面使用智能防外破系统，主要有如下功能：
·设置设备信息：用户可以在主站设置前端设备的id、地址等信息
·获取设备信息：可以远程获取前端设备的历史状态信息及历史报警信息
·远程控制：可以远程操作前端设备的摄像头以及启停设备
·更新设备：可以对前端设备子系统进行更新，或者更新目标检测模型
·动态模型训练：利用报警信息中的数据进行目标检测模型动态训练
其中，获取设备信息、远程控制和更新设备功能需要前端设备子系统与主站子系统的网络互联。

4.2.3 操作时序图
主站子系统即用户直接访问的系统，用户通过网页访问主站子系统，并对整个智能防外破系统进行操作，主要的功能有设置设备信息、获取设备信息、远程控制、更新设备以及动态模型训练。
该部分对设置设备信息、获取设备信息、远程控制及更新设备的功能做了详细的操作时序图。
设置设备信息时，用户首先对主站子系统发送设置信息的请求，随后主站子系统先后对前端设备子系统及数据库中的设备信息表进行信息更新。

获取设备信息时首先对主站子系统发送请求，主站子系统随即对前端设备子系统发送请求，此时判断请求类型，若请求状态信息，则从状态信息表中获取信息并返回，若请求报警信息，则从报警信息表中获取信息并返回。
远程控制时首先对主站子系统发送请求，主站子系统随即对前端设备子系统发送请求，此时判断请求类型，若请求控制摄像头，则前端设备子系统对摄像头下达相应命令，若请求关闭设备，则前端设备子系统对自身下达关闭命令。

更新设备时首先对主站子系统发送请求，此时判断请求类型，若请求更新系统，则向前端设备子系统传送更新包并执行，若请求更新模型，则向前端设备子系统传送模型。






5 系统实现与测试
5.1 技术路线
5.1.1 目标检测
目标检测算法采用YOLO+mobilenet算法。该算法将物体检测任务看做回归问题来处理，使用深度神经网络，将输入图像划分为的栅格，每个栅格负责检测中心落在该栅格中的物体，直接从整张图像来预测出边界框的坐标、框中包含物体的置信度和物体所属类别概率，然后进行非极大值抑制，筛选最可能包含目标的边界框。

如上图所示，检测结果可以得到目标位置（使用矩形框呈现）和目标类型（使用不同颜色呈现）。
YOLO v2实现了精确度高、识别速度快、表达能力强的深度神经网络。输入544 x 544的图像，识别平均精度达到78.6%，并且可以保持每秒识别40张图像的速度。



5.1.2 数据存储
前端设备可以设置经过固定时间间隔获取视频，并就地分析，并保存发现监测区域内发现危险源的目标信息和涉及图像、相关视频片段。自动删除一周前的数据，确保复查时有据可依，也尽可能提高存储空间的利用率。无危险源的视频数据及相关中间结果全部删除，拒绝无效信息以节省存储空间。
主站服务器接收所有前端设备发来的警报数据，数据量大时可以扩展为分布式接入、存储，通过Kafka管理消息队列将数据接入存储平台，将图像、视频数据存在NoSQL中，报警信息存在Oracle中。可以提供数据冗余保证系统的高可用性和数据的可靠性。
输电线路智能防外破系统均可使用类数据库接口操作，方便后续的开发、获取和分析，并且支持硬件扩充，可以给系统提供存储上的横向看扩展能力，方便数据调整、数据迁移。

5.1.3 视频关键帧提取
前端设备组工作时，摄像头拍摄的视频通过RSTP协议直接发送到主板，主板提取关键帧并进行后续分析。
由于视频序列中相邻帧一般具有相似性和连续性，如果在图像坐标系下将所有的视频帧重叠起来，那么一个镜头中所有视频帧的特征矢量在其特征空间中会形成一个轨迹，轨迹上的关键特征值对应的帧即为关键帧。关键帧抽取的过程分为两个步骤：寻找图像中某特种的量化参数；判断当前帧特征量化的参数是否为关键的特征值。
输电线路防外破智能监测主要查看当前区域是否出现入侵目标，于是选择使用基于内容分析的方法提取关键帧，使用特征信息之间的距离度量，计算前一帧与剩余帧之差，如果差值过大，则说明内容差别较大，会选择内容上比较有代表性的帧作为关键帧。




5.2 模型训练
5.2.1 数据准备
5.2.2 训练
5.2.3 训练结果

5.3 软件实现
5.3.1 前端设备子系统软件实现

图5-2 前端设备子系统类图
前端设备子系统总控模块中包含7个类，MediaFile类表示媒体文件。VideoFile和ImageFile继承自MediaFile文件，分别表示视频文件和图像文件，他们都拥有一个AlarmInfo类，用来标记该媒体文件的警报类型和警报信息。他们都有一个Clean接口类，用来将超过保存时间限制的文件清理。他们和Result类关联，用来记录图像和视频的识别结果。他们也和Client类关联，用来将信息发送到主站。

1、总控模块的实现。

图5-3 总控模块流程图
总控模块是始终在前端设备循环运行的模块，用来不断从视频中抽取图像进行识别，若检测到异物入侵，则将报警信息发送到主站，若没有检测到异物入侵，则不执行任何操作。
总控模块重点代码如下。
config=getconfig(config_address="/home/nvidia/anti-outbreak/profile/config.ini")
#get now_time
current_time = time.strftime('%Y-%m-%d %H:%M:%S', time.localtime())
#get video&image file
mediafolder = config.get("all", "media_folder")
video_address = mediafolder + "/" + config.get("video", "video_address")
video = Video(file_address=video_address)
image_address = mediafolder + "/" + config.get("image", "image_address")
img = Img(file_address=image_address)
#detect
result = detect(video, img, config)
if result.flaglen == 0:
return
#mark the video&image
processing(video, img, config, result)
#send the alarmmessage
send_alarmmsg(video, img, config, result, current_time)
2、图像识别模块的实现。
图像识别模块是前端设备子系统的核心模块，采用YOLOv2目标检测算法,用来检测图像有无大型施工车辆。
YOLOv2采用开源代码，对其识别部分代码进行了一些修改，将训练好的模型存放在磁盘中，并且利用其提供好的python接口对图片进行目标检测识别。
图像识别模块重点代码如下。
class Result():
	def __init__(self, flaglen=0):
		self.flaglen = flaglen
	def build(self):	
		self.flag = [0 for i in range(0, self.flaglen)]
		self.x = [0 for i in range(0, self.flaglen)]
		self.y = [0 for i in range(0, self.flaglen)]
def detect_martix(img):
	result = Result()
	return	result
def detect_url(image_address):
	#setting GPU
	dn.set_gpu(0)
	
	#buding config file
	config = configparser.ConfigParser()
	config.read('/home/nvidia/anti-outbreak/profile/config.ini')
	#read model message from config file
	address_multi = config.get("detect", "model_address_multi")
	net_multi = config.get("detect", "model_net_multi")
	meta_multi = config.get("detect", "model_meta_multi")
	net, meta = dn.load(meta_multi, net_multi, address_multi, 0)
	r = dn.detect(net, meta, image_address, 0.24)
	#check if detect
	if len(r) == 0:
		result = Result()
	else:
		result = Result(flaglen = len(r))
		result.build()
	for i in range(len(r)):
		flag = types2int(r[i][0])
		result.flag[i] = flag
		result.x[i] = r[i][2][0]
		result.y[i] = r[i][2][1]
	return result
def types2int(types):
	#set configfile:
	config = configparser.ConfigParser()
	config.read('../../profile/alarmtype.ini')
	#get type from ini:
	typeline = config.options("typeflag")
	for i in range(len(typeline)):
		if types == typeline[i] :
			return config.getint("typeflag", typeline[i])
3、视频处理模块的实现。
视频处理模块包括提取视频关键帧和为视频添加报警信息两个功能，封装在VideoFile类中。
视频处理模块关键代码如下。
class VideoFile(fileop.MediaFile):
	def __init__(self, file_address='', flag=1, duration='00:00:30'):
		fileop.MediaFile.__init__(self, file_address, flag)
		self.duration = duration
def setrtsp(self, rtsp_address='rtsp://admin:iie123456@172.16.168.207:554/h264/ch1/main/av_stream'):
		self.rtsp_address = rtsp_address
	def setduration(self, newduration):
		self.duration = newduration
def loadfrom_rtsp(self):
		if self.rtsp_address is None:
			print("Err:The Rtsq Address is Needed")
			return
		cmd = "ffmpeg -i " + self.rtsp_address + " -vcodec copy -t " + self.duration + " -y -f flv " + self.file_address
		subprocess.call(cmd, shell=True)
	def crop(self, timeout="0:0:08", outfilename='out.flv'):
		if outfilename == self.file_address :
         		print("Warning:If the output fill ename is equil with input file name, some unknown bug will happen \n")
         		print("Please change a new output filename")
              return
		cmd = "ffmpeg -ss 00:00:00 -t " + timeout + " -i " + self.file_address + " -codec copy -y " + outfilename
		subprocess.call(cmd, shell=True)
	def addwords(self, location="Unknown Location", outfilename='out.flv'):
		if outfilename == self.file_address:
			print("Warning:If the output fill ename is equil with input file name, some unknown bug will happen \n")
			print("Please change a new output filename")
			return
		fh = open('output.srt', 'w')
		fh.write('1' + '\n')
		fh.write('00:00:00,000 --> ' + self.duration +",000" + '\n')
		fh.write(location)
		fh.close()
cmd = "ffmpeg -i output.flv -vf subtitles=output.srt -y " + outfilename
		subprocess.call(cmd, shell=True)
		os.remove('output.srt')
def mark(self, location="Unknown Location", timeout = "0:0:08", outfilename='out.flv'):
		if outfilename == self.file_address :
			print("Warning:If the output fill ename is equil with input file name, some unknown bug will happen \n")
			print("Please change a new output filename")
			return
self.crop(timeout, 'output.flv')
		self.addwords(location, outfilename)
		os.remove('output.flv')
4、文件修改模块的实现。
文件修改模块主要实现了报警信息中图片和视频的自清理功能，用一个接口类Clean来实现。
class Clean():
	def __init__(self, file_url):
		self.file_url = file_url
def delfile(self, cleandate):
		f =  list(os.listdir(self.file_url))
		for i in range(len(f)):
			filedate = os.path.getmtime(self.file_url + f[i])
			time1 = datetime.datetime.fromtimestamp(filedate).strftime('%Y-%m-%d')
			date1 = time.time()
			num1 =(date1 - filedate)/60/60/24 
			if num1 >= cleandate:
				try:
					os.remove(self.file_url + f[i])
				except Exception as e:
					print(e)
5、状态采集模块的实现。
6、加密模块的实现。
7、设备遥控模块的实现。
8、数据库设计与实现。
数据库采用SQLite实现，利用其python接口，在总控模块中配合各个功能模块使用，保证删除或增加图片视频条目的时候，对应的在磁盘中也删除或增加图片视频。

5.3.2 主站子系统软件实现
1、文件修改模块的实现。
2、数据库设计与实现。
3、网页设计。


5.4 硬件实现






6 系统运行测试



















7 总结















致 谢


参考文献

参考文献
[1] 卓高智. 输电线路防外力破坏的原因及措施分析[J]. 中国高新技术企业, 2012(1):131-133.
[2] 张明明. 外力破坏:电网不能承受之重[J]. 大众用电, 2003(11):4-5.
[3] 曲丽峰, 崔凯, 曲艳芬. 论如何开展输电线路防外力破坏工作[J]. 科技信息, 2011(26):316-317.
[4] 王国胜, 张声圳. 输电线路防外力破坏监测系统的研究[J]. 陕西电力, 2013, 41(8):64-67.
[5] Ross Girshick, Jeff Donahue, Trevor Darrel, Jitendra Malil. arXiv:1311.2524[cs.CV]
[6] Girshick R. Fast R-CNN[J]. Computer Science, 2015.
[7] Ren S, Girshick R, Girshick R, et al. Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks[J]. IEEE Trans Pattern Anal Mach Intell, 2015, 39(6):1137-1149.
[8] Redmon J, Divvala S, Girshick R, et al. You Only Look Once: Unified, Real-Time Object Detection[J]. 2015:779-788.
[9] Liu W, Anguelov D, Erhan D, et al. SSD: Single Shot MultiBox Detector[C]// European Conference on Computer Vision. Springer International Publishing, 2016:21-37.
[10] He K, Gkioxari G, Dollar P, et al. Mask R-CNN[J]. IEEE Transactions on Pattern Analysis & Machine Intelligence, 2017, PP(99):1-1.
[11] 曹长青. 基于内容的视频检索中关键帧提取算法研究[D]. 太原理工大学, 2013.
张占龙, 杨霁, 熊兰,等. 基于微波感应技术的语音报警器[J]. 电力系统自动化, 2006, 30(17):94-96.
洪盛国. 多普勒雷达探测器AS-MMS525[J]. 电子世界, 2003(8):50-52.
韩永璞, 彭智. 输电线监测系统的设计与实现[J]. 中国电业:技术版, 2015(12).
张一东, 杨帆, 谭波,等. 输电线路杆塔防外力破坏监测装置: CN, CN 102646307 A[P]. 2012.
Philips Component Co, 龚惠明. 红外探测器[J]. 上海航天, 1989(5).
